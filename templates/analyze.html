<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stratosphere Market Analysis Report</title>
    <style>
        /* BASE STYLES */
        body { font-family: 'Arial', sans-serif; max-width: 900px; margin: 40px auto; line-height: 1.6; color: #333; background-color: #fcfcfc; }
        h1 { color: #1a1a1a; border-bottom: 3px solid #2980b9; padding-bottom: 8px; margin-bottom: 30px; font-size: 24px; }
        h2 { color: #2980b9; margin-top: 30px; font-size: 20px; }
        h3 { color: #34495e; font-size: 16px; margin-top: 15px; margin-bottom: 5px; border-bottom: 1px dashed #ccc; padding-bottom: 5px; }

        /* INPUT BOX */
        .query-box { background: #eef4f9; padding: 15px; border-radius: 6px; margin-bottom: 30px; border-left: 5px solid #3498db; font-size: 14px; }
        
        /* EXECUTIVE SUMMARY */
        .exec-summary { 
            background: #e6fff1; 
            color: #006400;
            padding: 20px; 
            border-radius: 6px; 
            margin-bottom: 30px; 
            font-size: 16px; 
            font-weight: bold; 
            line-height: 1.5;
            border: 1px solid #d4edda;
        }

        /* TEXT OUTPUT CONTAINER (ROBUST) */
        .analysis-output { 
            background: #f2f2f2; 
            padding: 20px; 
            border-radius: 6px; 
            white-space: pre-wrap; /* Maintains line breaks from the agent's output */
            text-align: left;
            margin-top: 20px;
        }

        /* KEYWORD STYLING for the console output look */
        .analysis-output code { 
            display: block; 
            font-family: monospace; 
            line-height: 1.2;
            padding: 10px 0;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>Stratosphere Market Analyst: Client Brief</h1>

    <div class="query-box">
        <strong>Input Query:</strong> {{ query }}<br>
        <strong>Search Status:</strong> {{ "Active" if search_used else "Disabled (General Knowledge)" }}
    </div>

    {% if analysis %}
        
        {# Display the entire cleaned analysis string inside a safe, pre-formatted code block #}
        {# The 'safe' filter is CRITICAL: it prevents Jinja from escaping HTML entities like <, >, 
           but since we stripped ** it should now render without breaking the page layout. #}
        <div class="analysis-output">
            <h2>Raw Agent Analysis (Structured)</h2>
            <code>{{ analysis | safe }}</code>
        </div>
        
    {% else %}
        <p>Analysis failed or returned no content. Please check the Render logs for API errors.</p>
    {% endif %}
</body>
</html>